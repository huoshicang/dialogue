"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[181],{7181:function(e,l,a){a.r(l),a.d(l,{default:function(){return h}});var i=a(6768),t=a(4232),o=a(144);const n={id:"keyFrom"};var u=(0,i.pM)({__name:"KeysFrom",props:{loading:{type:Boolean,default:!1}},emits:["setLoading","setData","setVisible"],setup(e,{emit:l}){const a=(0,o.Kh)({}),t=l,u=e,d=async({errors:e,values:l})=>{if(!u.loading&&!e){t("setLoading",!0);try{console.log("搜索成功"),t("setData",[])}catch(a){console.log("搜索失败")}finally{t("setLoading",!1)}}};return(e,l)=>{const o=(0,i.g2)("a-button"),u=(0,i.g2)("a-space"),s=(0,i.g2)("a-form-item"),r=(0,i.g2)("a-form");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.bF)(r,{model:a,layout:"inline",onSubmit:d},{default:(0,i.k6)((()=>[(0,i.bF)(s,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.bF)(o,{"html-type":"submit",disabled:""},{default:(0,i.k6)((()=>l[1]||(l[1]=[(0,i.eW)("搜索")]))),_:1}),(0,i.bF)(o,{onClick:l[0]||(l[0]=e=>t("setVisible",{visible:!0,title:"新建模型"}))},{default:(0,i.k6)((()=>l[2]||(l[2]=[(0,i.eW)(" 新建 ")]))),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])}}}),d=a(1241);const s=(0,d.A)(u,[["__scopeId","data-v-af2b706c"]]);var r=s,b=a(3124),m=a(1245),k=a(2426);const c={id:"keyModal"};var _=(0,i.pM)({__name:"KeysModal",props:{keyVisible:{type:Object,required:!0,default:{visible:!1,title:null}},keyInfo:{type:Object,required:!0,default:{user_name:"",base_url:"",model_name:"",model_call:"",model_introduction:"",model_call_input:0,model_call_output:0,limit:0,residue_limit:0}}},emits:["setVisible","requestData"],setup(e,{emit:l}){const a=(0,k.k)(),n=(0,k.k)().user_info,u=e,d=l,s=(0,o.Kh)({key:"",key_introduction:"",limit:null,residue_limit:null,availableModels:[],enable:!1,charging:!1}),r={key:[{required:!0,message:"密钥 不可为空"}],key_introduction:[{required:!1}],availableModels:[{required:!1}],limit:[{required:!0,message:"可用额度 不可为空"}],residue_limit:[{required:!0,message:"剩余额度 不可为空"}]},_=async({errors:e,values:l})=>{if(u.keyVisible.visible&&!e){d("setVisible",u.keyVisible.visible);try{l.user_name=n.username,l.user_id=n._id;const e=await b.j.add_key(l);200===e.status_code?(m.A.success(e.message),d("requestData")):m.A.error(e.message)}catch(a){console.log("添加失败")}finally{d("setVisible",{visible:!1,title:null})}}};return(0,i.nT)((()=>{if(u.keyVisible.visible)switch(u.keyVisible.title){case"新建模型":s.key="",s.key_introduction="",s.availableModels=[],s.limit=null,s.residue_limit=null,s.enable=!0,s.charging=!0;break;case"编辑密钥":s.key=u.keyInfo.key,s.key_introduction=u.keyInfo.key_introduction,s.availableModels=u.keyInfo.availableModels,s.limit=u.keyInfo.limit,s.residue_limit=u.keyInfo.residue_limit,s.enable=u.keyInfo.enable,s.charging=u.keyInfo.charging;break;default:break}})),(0,i.sV)((async()=>{0===a.gettersModelList.length&&await a.getModelList()})),(e,l)=>{const n=(0,i.g2)("a-input"),d=(0,i.g2)("a-form-item"),b=(0,i.g2)("a-option"),m=(0,i.g2)("a-select"),k=(0,i.g2)("a-textarea"),g=(0,i.g2)("a-input-number"),v=(0,i.g2)("a-switch"),y=(0,i.g2)("a-button"),f=(0,i.g2)("a-form"),p=(0,i.g2)("a-modal");return(0,i.uX)(),(0,i.CE)("div",c,[(0,i.bF)(p,{width:"auto",visible:u.keyVisible.visible,"onUpdate:visible":l[7]||(l[7]=e=>u.keyVisible.visible=e),footer:!1},{title:(0,i.k6)((()=>[(0,i.eW)((0,t.v_)(u.keyVisible.title),1)])),default:(0,i.k6)((()=>[(0,i.bF)(f,{ref:"formRef",rules:r,style:{width:"600px"},model:s,onSubmit:_},{default:(0,i.k6)((()=>[(0,i.bF)(d,{field:"key",label:"密钥","validate-trigger":"blur"},{default:(0,i.k6)((()=>[(0,i.bF)(n,{modelValue:s.key,"onUpdate:modelValue":l[0]||(l[0]=e=>s.key=e)},null,8,["modelValue"])])),_:1}),(0,i.bF)(d,{field:"availableModels",label:"可用模型","validate-trigger":"blur"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{"model-value":s.availableModels,"onUpdate:modelValue":l[1]||(l[1]=e=>s.availableModels=e),placeholder:"请选择模型","allow-clear":"",multiple:""},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(a).gettersModelList,((e,l)=>((0,i.uX)(),(0,i.Wv)(b,{key:l},{default:(0,i.k6)((()=>[(0,i.eW)((0,t.v_)(e.model_call),1)])),_:2},1024)))),128))])),_:1},8,["model-value"])])),_:1}),(0,i.bF)(d,{field:"key_introduction",label:"密钥说明","validate-trigger":"blur"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{"model-value":s.key_introduction,"onUpdate:modelValue":l[2]||(l[2]=e=>s.key_introduction=e),"auto-size":{maxRows:4,minRows:1},"allow-clear":"","show-word-limit":""},null,8,["model-value"])])),_:1}),(0,i.bF)(d,{field:"limit",label:"总额度"},{default:(0,i.k6)((()=>[(0,i.bF)(g,{modelValue:s.limit,"onUpdate:modelValue":l[3]||(l[3]=e=>s.limit=e)},null,8,["modelValue"])])),_:1}),(0,i.bF)(d,{field:"residue_limit",label:"剩余额度"},{default:(0,i.k6)((()=>[(0,i.bF)(g,{modelValue:s.residue_limit,"onUpdate:modelValue":l[4]||(l[4]=e=>s.residue_limit=e)},null,8,["modelValue"])])),_:1}),"编辑密钥"===u.keyVisible.title?((0,i.uX)(),(0,i.Wv)(d,{key:0,field:"enable",label:"是否启用"},{default:(0,i.k6)((()=>[(0,i.bF)(v,{modelValue:s.enable,"onUpdate:modelValue":l[5]||(l[5]=e=>s.enable=e)},null,8,["modelValue"])])),_:1})):(0,i.Q3)("",!0),"编辑密钥"===u.keyVisible.title?((0,i.uX)(),(0,i.Wv)(d,{key:1,field:"charging",label:"是否进行计费"},{default:(0,i.k6)((()=>[(0,i.bF)(v,{modelValue:s.charging,"onUpdate:modelValue":l[6]||(l[6]=e=>s.charging=e)},null,8,["modelValue"])])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(y,{type:"primary","html-type":"submit"},{default:(0,i.k6)((()=>l[8]||(l[8]=[(0,i.eW)(" 确认")]))),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])}}});const g=(0,d.A)(_,[["__scopeId","data-v-6d9f2dfe"]]);var v=g,y=a(1387);const f={id:"keyIndex"};var p=(0,i.pM)({__name:"KeysIndex",setup(e){(0,y.rd)();const l=(0,k.k)().user_info,a=[{title:"创建人",dataIndex:"user_name",slotName:"user_name",width:60,align:"center"},{title:"密钥",dataIndex:"key",ellipsis:!0,tooltip:!0,width:90,align:"center"},{title:"额度",slotName:"limit",width:120,align:"center"},{title:"可用模型",slotName:"availableModels",align:"center",width:300},{title:"计费",slotName:"charging",width:50,align:"center"},{title:"状态",slotName:"enable",width:50,align:"center"},{title:"描述",dataIndex:"key_introduction",ellipsis:!0,tooltip:!0,width:100,align:"center"},{title:"操作",slotName:"optional",width:60,align:"center"}],n=(0,o.KR)([]),u=(0,o.KR)(!0),d=(0,o.KR)({visible:!1,title:null}),s=(0,o.KR)({user_name:"",key:"",key_introduction:"",availableModels:[],limit:0,residue_limit:0,enable:null,charging:null}),c=e=>{u.value=e},_=e=>{n.value=e},g=e=>{d.value.visible=e.visible,d.value.title=e.title},p=e=>{"编辑"===e.value&&g({visible:!0,title:"编辑密钥"})},V=e=>{s.value.user_name=e.user_name,s.value.key=e.key,s.value.key_introduction=e.key_introduction,s.value.availableModels=e.availableModels,s.value.limit=e.limit,s.value.residue_limit=e.residue_limit,s.value.charging=e.charging,s.value.enable=e.enable},h=async()=>{try{const e=await b.j.get_key_list({user_id:l._id,user_name:l.username,user_role:l.role});200===e.status_code?(_(e.data),m.A.success(e.message)):m.A.error(e.message)}catch(e){console.log("密钥失败")}finally{u.value=!1}};return(0,i.sV)((()=>{h()})),(e,l)=>{const o=(0,i.g2)("a-tag"),b=(0,i.g2)("a-space"),m=(0,i.g2)("a-button"),k=(0,i.g2)("a-doption"),y=(0,i.g2)("a-dropdown"),F=(0,i.g2)("a-table");return(0,i.uX)(),(0,i.CE)("div",f,[(0,i.bF)(r,{onSetLoading:c,onSetData:_,onSetVisible:g,loading:u.value},null,8,["loading"]),(0,i.bF)(F,{columns:a,data:n.value,loading:u.value},{user_name:(0,i.k6)((({record:e})=>[(0,i.bF)(o,{size:"large"},{default:(0,i.k6)((()=>[(0,i.eW)((0,t.v_)(e.user_name),1)])),_:2},1024)])),charging:(0,i.k6)((({record:e})=>[e.charging?((0,i.uX)(),(0,i.Wv)(o,{key:0,color:"green"},{default:(0,i.k6)((()=>l[2]||(l[2]=[(0,i.eW)("启用")]))),_:1})):((0,i.uX)(),(0,i.Wv)(o,{key:1,color:"red"},{default:(0,i.k6)((()=>l[3]||(l[3]=[(0,i.eW)("禁用")]))),_:1}))])),enable:(0,i.k6)((({record:e})=>[e.enable?((0,i.uX)(),(0,i.Wv)(o,{key:0,color:"green"},{default:(0,i.k6)((()=>l[4]||(l[4]=[(0,i.eW)("启用")]))),_:1})):((0,i.uX)(),(0,i.Wv)(o,{key:1,color:"red"},{default:(0,i.k6)((()=>l[5]||(l[5]=[(0,i.eW)("禁用")]))),_:1}))])),limit:(0,i.k6)((({record:e})=>[(0,i.eW)((0,t.v_)(e.limit)+"/"+(0,t.v_)(e.residue_limit),1)])),availableModels:(0,i.k6)((({record:e})=>[(0,i.bF)(b,{wrap:""},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.availableModels,((e,l)=>((0,i.uX)(),(0,i.Wv)(o,{key:l},{default:(0,i.k6)((()=>[(0,i.eW)((0,t.v_)(e),1)])),_:2},1024)))),128))])),_:2},1024)])),optional:(0,i.k6)((({record:e})=>[(0,i.bF)(y,{onSelect:p},{content:(0,i.k6)((()=>[(0,i.bF)(k,{value:{value:"编辑"},onClick:l=>V({...e})},{default:(0,i.k6)((()=>l[7]||(l[7]=[(0,i.eW)("编辑 ")]))),_:2},1032,["onClick"]),(0,i.bF)(k,{value:{value:"删除"}},{default:(0,i.k6)((()=>l[8]||(l[8]=[(0,i.eW)("删除")]))),_:1})])),default:(0,i.k6)((()=>[(0,i.bF)(m,null,{default:(0,i.k6)((()=>l[6]||(l[6]=[(0,i.eW)("操作")]))),_:1})])),_:2},1024)])),_:1},8,["data","loading"]),(0,i.bF)(v,{keyVisible:d.value,"onUpdate:keyVisible":l[0]||(l[0]=e=>d.value=e),keyInfo:s.value,"onUpdate:keyInfo":l[1]||(l[1]=e=>s.value=e),onSetVisible:g,onRequestData:h},null,8,["keyVisible","keyInfo"])])}}});const V=(0,d.A)(p,[["__scopeId","data-v-786860e8"]]);var h=V}}]);
//# sourceMappingURL=181.409975a1.js.map